<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Global Chat</title>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100"><div class="flex flex-col h-screen">
  <div class="bg-white p-4 shadow flex items-center justify-between">
    <h1 class="text-xl font-bold">Global Chat</h1>
    <button id="logoutBtn" class="text-sm text-red-500 font-medium">Logout</button>
  </div>  <div id="chatArea" class="flex-1 overflow-y-auto px-4 py-2 flex flex-col-reverse space-y-2-reverse bg-gray-50">
    <!-- Messages will be injected here -->
  </div>  <div class="p-4 bg-white shadow-inner sticky bottom-0">
    <form id="messageForm" class="flex items-center space-x-2">
      <input id="messageInput" type="text" placeholder="Type your message..."
             class="flex-1 border rounded-full px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400" required />
      <button type="submit"
              class="bg-blue-500 text-white rounded-full px-4 py-2 hover:bg-blue-600 transition">Send</button>
    </form>
  </div>
</div><script>
  const firebaseConfig = {
    apiKey: 'AIzaSyAx0q_QGU35tLFP4MtUMQQUtw-WVNagpHk',
    authDomain: 'izuchukwu-foods.firebaseapp.com',
    projectId: 'izuchukwu-foods',
    storageBucket: 'izuchukwu-foods.appspot.com',
    messagingSenderId: '811147638426',
    appId: '1:811147638426:web:f2403b6cf7e0b6f19b1123'
  };

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  const chatArea = document.getElementById("chatArea");
  const messageForm = document.getElementById("messageForm");
  const messageInput = document.getElementById("messageInput");
  const logoutBtn = document.getElementById("logoutBtn");

  let currentUser = null;

  auth.onAuthStateChanged(async user => {
    if (!user) {
      window.location.href = "/login.html";
    } else {
      currentUser = user;
      listenToMessages();
    }
  });

  logoutBtn.onclick = () => auth.signOut();

  async function getUsername(uid) {
    try {
      const doc = await db.collection("users").doc(uid).get();
      return doc.exists ? doc.data().username || "Unnamed" : "Unnamed";
    } catch (e) {
      return "Unnamed";
    }
  }

  function listenToMessages() {
    db.collection("chats")
      .orderBy("timestamp", "desc")
      .limit(50)
      .onSnapshot(async snapshot => {
        chatArea.innerHTML = "";
        const messages = [];

        for (const docSnap of snapshot.docs) {
          const msg = docSnap.data();
          const id = docSnap.id;
          const senderName = await getUsername(msg.uid);
          const isMine = msg.uid === currentUser?.uid;

          const div = document.createElement("div");
          div.className = `p-2 rounded-lg max-w-lg ${isMine ? "bg-green-100 self-end ml-auto" : "bg-white"} shadow border`;

          div.innerHTML = `
            <p class="text-sm font-semibold">${senderName}</p>
            <p class="text-sm">${msg.text}</p>
            <p class="text-xs text-gray-400 text-right">${new Date(msg.timestamp?.toDate?.()).toLocaleTimeString()}</p>
          `;

          messages.push(div);
        }

        messages.reverse().forEach(m => chatArea.appendChild(m));
      });
  }

  messageForm.onsubmit = async (e) => {
    e.preventDefault();
    const text = messageInput.value.trim();
    if (!text) return;

    await db.collection("chats").add({
      text,
      uid: currentUser.uid,
      timestamp: firebase.firestore.FieldValue.serverTimestamp(),
    });

    messageInput.value = "";
  }
</script></body>
</html>