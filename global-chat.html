<!DOCTYPE html><html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Global Chat | DavintoHQ</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
  <header>
    <h2><i class="fas fa-comments"></i> Global Chat</h2>
    <button id="themeToggle"><i class="fas fa-adjust"></i></button>
  </header>  <div id="chatBox" class="chat-container"></div>  <div class="chat-input">
    <input type="text" id="chatMessage" placeholder="Type your message...">
    <button id="sendBtn"><i class="fas fa-paper-plane"></i></button>
  </div>  <template id="message-template">
    <div class="message">
      <div class="meta"><strong class="name"></strong> <small class="timestamp"></small></div>
      <div class="text"></div>
      <div class="actions">
        <span class="react" data-type="heart">❤️</span>
        <span class="react" data-type="laugh">😂</span>
        <span class="react" data-type="fire">🔥</span>
        <button class="reply"><i class="fas fa-reply"></i></button>
        <button class="pin"><i class="fas fa-thumbtack"></i></button>
        <button class="forward"><i class="fas fa-share"></i></button>
        <button class="pm"><i class="fas fa-envelope"></i></button>
        <button class="edit"><i class="fas fa-edit"></i></button>
        <button class="delete"><i class="fas fa-trash"></i></button>
      </div>
    </div>
  </template>  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';
    import {
      getFirestore, collection, addDoc, serverTimestamp, onSnapshot, query, orderBy, doc, updateDoc, deleteDoc, getDoc
    } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js';
    import {
      getAuth, signInAnonymously, onAuthStateChanged
    } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js';

    const firebaseConfig = {
      apiKey: "AIzaSyDT5tgWOLu3oUf7XTFsFzAuszUcERhoOTw",
      authDomain: "davintohq.firebaseapp.com",
      projectId: "davintohq",
      storageBucket: "davintohq.appspot.com",
      messagingSenderId: "156992522736",
      appId: "1:156992522736:web:7db1c51a089d9d1bad3535"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth();
    signInAnonymously(auth);

    let currentUser;
    onAuthStateChanged(auth, user => {
      if (user) currentUser = user;
    });

    const chatBox = document.getElementById('chatBox');
    const chatMessage = document.getElementById('chatMessage');
    const sendBtn = document.getElementById('sendBtn');

    sendBtn.onclick = async () => {
      const text = chatMessage.value.trim();
      if (!text || !currentUser) return;
      await addDoc(collection(db, 'globalChats'), {
        uid: currentUser.uid,
        text,
        name: 'User',
        timestamp: serverTimestamp(),
        reactions: {}
      });
      chatMessage.value = '';
    };

    const template = document.getElementById('message-template');
    const q = query(collection(db, 'globalChats'), orderBy('timestamp'));
    onSnapshot(q, (snapshot) => {
      chatBox.innerHTML = '';
      snapshot.forEach(docSnap => {
        const data = docSnap.data();
        const clone = template.content.cloneNode(true);
        clone.querySelector('.name').textContent = data.name || 'User';
        clone.querySelector('.text').textContent = data.text;
        clone.querySelector('.timestamp').textContent = data.timestamp?.toDate().toLocaleTimeString() || '';

        const msgDiv = clone.querySelector('.message');
        if (data.uid === currentUser?.uid) msgDiv.classList.add('me');

        const reacts = clone.querySelectorAll('.react');
        reacts.forEach(r => r.dataset.id = docSnap.id);

        clone.querySelector('.edit').dataset.id = docSnap.id;
        clone.querySelector('.delete').dataset.id = docSnap.id;

        chatBox.appendChild(clone);
      });
      chatBox.scrollTop = chatBox.scrollHeight;
    });

    document.addEventListener('click', async e => {
      if (e.target.classList.contains('edit')) {
        const id = e.target.dataset.id;
        const newText = prompt('Edit message:');
        if (newText) await updateDoc(doc(db, 'globalChats', id), { text: newText });
      } else if (e.target.classList.contains('delete')) {
        const id = e.target.dataset.id;
        await deleteDoc(doc(db, 'globalChats', id));
      } else if (e.target.classList.contains('react')) {
        const id = e.target.dataset.id;
        const type = e.target.dataset.type;
        const ref = doc(db, 'globalChats', id);
        const snap = await getDoc(ref);
        if (snap.exists()) {
          const data = snap.data();
          const reactions = { ...data.reactions };
          reactions[type] = (reactions[type] || 0) + 1;
          await updateDoc(ref, { reactions });
        }
      }
    });

    const themeToggle = document.getElementById('themeToggle');
    themeToggle.onclick = () => {
      const root = document.documentElement;
      const theme = root.getAttribute('data-theme');
      root.setAttribute('data-theme', theme === 'light' ? 'dark' : 'light');
    };
  </script></body>
</html>