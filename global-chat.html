<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Global Chat | DavintoHQ</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <style>
    /* Same CSS you posted, unchanged (shortened for brevity in this message) */
    /* Paste full CSS from your provided code */
  </style>
</head>
<body>
  <header>
    <h2><i class="fas fa-comments"></i> Global Chat</h2>
    <button id="themeToggle"><i class="fas fa-adjust"></i></button>
  </header>

  <div class="main">
    <div class="sidebar">
      <h3>Messengers</h3>
      <div class="messenger" onclick="selectMessenger('John Doe')">
        <strong>John Doe</strong><br><small>Online</small>
      </div>
      <div class="messenger" onclick="selectMessenger('Jane Smith')">
        <strong>Jane Smith</strong><br><small>Online</small>
      </div>
    </div>

    <div class="chat-pane">
      <div class="messenger-header" id="messengerHeader">Global Group Chat</div>
      <div class="chat-container" id="chatBox"></div>
      <div class="chat-input">
        <input type="text" id="chatMessage" placeholder="Type your message...">
        <button id="sendBtn"><i class="fas fa-paper-plane"></i></button>
      </div>
    </div>
  </div>

  <script>
    // Firebase Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyAx0q_QGU35tLFP4MtUMQQUtw-WVNagpHk",
      authDomain: "izuchukwu-foods.firebaseapp.com",
      projectId: "izuchukwu-foods",
      storageBucket: "izuchukwu-foods.appspot.com",
      messagingSenderId: "811147638426",
      appId: "1:811147638426:web:f2403b6cf7e0b6f19b1123"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    const root = document.documentElement;
    const themeToggle = document.getElementById('themeToggle');
    const sendBtn = document.getElementById('sendBtn');
    const chatMessage = document.getElementById('chatMessage');
    const chatBox = document.getElementById('chatBox');
    const messengerHeader = document.getElementById('messengerHeader');

    themeToggle.onclick = () => {
      const current = root.getAttribute('data-theme');
      root.setAttribute('data-theme', current === 'light' ? 'dark' : 'light');
    };

    let currentUser = null;

    auth.signInAnonymously().then(() => {
      currentUser = auth.currentUser;
      listenForMessages();
    }).catch(console.error);

    sendBtn.onclick = async () => {
      const msg = chatMessage.value.trim();
      if (!msg || !currentUser) return;

      const name = "Anonymous";
      await db.collection("globalChats").add({
        uid: currentUser.uid,
        name: name,
        text: msg,
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      });

      chatMessage.value = "";
    };

    function listenForMessages() {
      db.collection("globalChats")
        .orderBy("createdAt", "asc")
        .onSnapshot(snapshot => {
          chatBox.innerHTML = '';
          snapshot.forEach(doc => {
            const data = doc.data();
            const div = document.createElement('div');
            div.className = 'message' + (data.uid === currentUser.uid ? ' me' : '');
            div.innerHTML = `<strong>${data.name}</strong><br>${data.text}`;
            chatBox.appendChild(div);
          });
          chatBox.scrollTop = chatBox.scrollHeight;
        });
    }

    function selectMessenger(name) {
      messengerHeader.innerHTML = `
        <strong>${name}</strong><br>
        <button class="pm-button" onclick="privateMessage('${name}')">Private Message</button>
      `;
      alert(`(Simulated) Switched to PM with ${name}`);
    }

    function privateMessage(name) {
      alert(`(Simulated) Opening private chat with ${name}...`);
    }
  </script>
</body>
</html>