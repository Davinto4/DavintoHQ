<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Manage Admins - DavintoHQ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex justify-center items-center">
  <div class="bg-white p-6 rounded shadow max-w-md w-full space-y-4">
    <h1 class="text-xl font-bold text-indigo-700">ðŸ‘‘ Manage Admins</h1>
    <p class="text-gray-600">Only the owner can view this page.</p>

    <div>
      <input type="text" id="uidInput" placeholder="Enter user UID" class="w-full px-3 py-2 border rounded mb-2" />
      <div class="flex gap-2">
        <button id="addBtn" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">Add Admin</button>
        <button id="removeBtn" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">Remove Admin</button>
      </div>
    </div>

    <div>
      <h2 class="text-lg font-semibold mt-4">Current Admins:</h2>
      <ul id="adminList" class="text-sm text-gray-700 mt-2 space-y-1"></ul>
    </div>

    <button onclick="logout()" class="mt-4 w-full bg-gray-800 text-white py-2 rounded hover:bg-black">Logout</button>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
    import { getFirestore, setDoc, deleteDoc, doc, getDocs, collection } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDT5tgWOLu3oUf7XTFsFzAuszUcERhoOTw",
      authDomain: "davintohq.firebaseapp.com",
      projectId: "davintohq",
      storageBucket: "davintohq.firebaseapp.com",
      messagingSenderId: "156992522736",
      appId: "1:156992522736:web:7db1c51a089d9d1bad3535"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth();
    const db = getFirestore();

    const ownerEmail = "macdinodavinto@gmail.com";
    const ownerPhone = "+2348169045105";

    async function loadAdmins() {
      const admins = await getDocs(collection(db, "admins"));
      const list = document.getElementById("adminList");
      list.innerHTML = "";
      admins.forEach(doc => {
        const li = document.createElement("li");
        li.textContent = `ðŸ‘¤ ${doc.id}`;
        list.appendChild(li);
      });
    }

    async function addAdmin(uid) {
      await setDoc(doc(db, "admins", uid), { role: "admin" });
      alert("Admin added!");
      loadAdmins();
    }

    async function removeAdmin(uid) {
      await deleteDoc(doc(db, "admins", uid));
      alert("Admin removed!");
      loadAdmins();
    }

    function logout() {
      signOut(auth).then(() => location.href = "index.html");
    }

    onAuthStateChanged(auth, async (user) => {
      if (!user) return location.href = "index.html";

      const emailOrPhone = user.email || user.phoneNumber;
      if (emailOrPhone !== ownerEmail && emailOrPhone !== ownerPhone) {
        alert("Access denied. Only the owner can manage admins.");
        return location.href = "index.html";
      }

      // Load admin list after owner check
      loadAdmins();

      document.getElementById("addBtn").onclick = () => {
        const uid = document.getElementById("uidInput").value.trim();
        if (uid) addAdmin(uid);
      };

      document.getElementById("removeBtn").onclick = () => {
        const uid = document.getElementById("uidInput").value.trim();
        if (uid) removeAdmin(uid);
      };
    });
  </script>
</body>
</html>
