<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DavintoHQ - Task Manager</title>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background: #f0f2f5; padding: 20px; }
    .container { max-width: 600px; margin: auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    h1 { text-align: center; }
    input, textarea, button, select { width: 100%; padding: 10px; margin: 5px 0; border-radius: 5px; border: 1px solid #ccc; }
    button { background-color: #007bff; color: white; cursor: pointer; }
    button:hover { background-color: #0056b3; }
    .task { padding: 10px; background: #f9f9f9; margin-top: 10px; border-left: 4px solid #007bff; }
    .task strong { color: #333; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Task Manager</h1><div id="userSection" style="margin-bottom: 20px;"></div>

<div id="taskForm" style="display: none;">
  <h3>Assign a New Task</h3>
  <input type="text" id="taskTitle" placeholder="Task Title" required>
  <textarea id="taskDescription" placeholder="Task Description" required></textarea>
  <input type="text" id="assignedTo" placeholder="Assign to (Username)" required>
  <button onclick="addTask()">Add Task</button>
</div>

<h3>My Tasks</h3>
<div id="taskList"></div>

  </div>  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDT5tgWOLu3oUf7XTFsFzAuszUcERhoOTw",
      authDomain: "davintohq.firebaseapp.com",
      projectId: "davintohq",
      storageBucket: "davintohq.appspot.com",
      messagingSenderId: "156992522736",
      appId: "1:156992522736:web:7db1c51a089d9d1bad3535"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    let currentUser = null;
    let currentUsername = "";

    auth.onAuthStateChanged(async user => {
      if (user) {
        currentUser = user;
        const userDoc = await db.collection('users').doc(user.uid).get();
        const userData = userDoc.data();
        currentUsername = userData.username || "Unknown";

        document.getElementById('userSection').innerHTML = `<p>Logged in as <strong>${currentUsername}</strong> (${userData.role})</p>`;

        if (userData.role === 'admin' || userData.role === 'owner') {
          document.getElementById('taskForm').style.display = 'block';
        }

        loadTasks();
      } else {
        document.getElementById('userSection').innerHTML = '<p>Please sign in to use tasks.</p>';
      }
    });

    async function addTask() {
      const title = document.getElementById('taskTitle').value;
      const description = document.getElementById('taskDescription').value;
      const assignedTo = document.getElementById('assignedTo').value;

      if (!title || !description || !assignedTo) {
        alert("Please fill in all fields.");
        return;
      }

      try {
        await db.collection('tasks').add({
          title,
          description,
          assignedTo,
          createdBy: currentUsername,
          timestamp: firebase.firestore.FieldValue.serverTimestamp()
        });
        alert("Task added successfully.");
        document.getElementById('taskTitle').value = "";
        document.getElementById('taskDescription').value = "";
        document.getElementById('assignedTo').value = "";
        loadTasks();
      } catch (error) {
        alert("Failed to add task: " + error.message);
      }
    }

    async function loadTasks() {
      const tasksRef = await db.collection('tasks').where("assignedTo", "==", currentUsername).orderBy("timestamp", "desc").get();
      const taskList = document.getElementById('taskList');
      taskList.innerHTML = "";
      tasksRef.forEach(doc => {
        const task = doc.data();
        taskList.innerHTML += `
          <div class="task">
            <strong>${task.title}</strong><br>
            ${task.description}<br>
            <small>Assigned by: ${task.createdBy}</small>
          </div>
        `;
      });
    }
  </script></body>
</html>